<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>íšŒì›ê°€ì… - ë™ë„¤ ì†Œë¶„ ë§ˆì¼“</title>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 400px; }
        h2 { text-align: center; margin-bottom: 20px; color: #333; }

        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 14px; }
        input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }

        /* ì§€ë„ ìŠ¤íƒ€ì¼ */
        #map { width: 100%; height: 250px; border-radius: 5px; border: 1px solid #ddd; margin-bottom: 10px; }
        .map-guide { font-size: 12px; color: #666; text-align: center; margin-bottom: 15px; }

        button { width: 100%; padding: 12px; background: #4CAF50; color: white; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; transition: background 0.3s; }
        button:hover { background: #45a049; }
        .link { text-align: center; margin-top: 15px; font-size: 14px; }
        .link a { color: #2196F3; text-decoration: none; }
    </style>
</head>
<body>

<div class="container">
    <h2>íšŒì›ê°€ì…</h2>

    <div class="form-group">
        <label>ë‹‰ë„¤ì„</label>
        <input type="text" id="nickname" placeholder="ì‚¬ìš©í•  ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”">
    </div>

    <div class="form-group">
        <label>ë¹„ë°€ë²ˆí˜¸</label>
        <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
    </div>

    <div class="form-group">
        <label>ë‚´ ë™ë„¤ ì„¤ì • (ì§€ë„ í´ë¦­)</label>
        <div id="map"></div>
        <div class="map-guide">ğŸ“ ì§€ë„ë¥¼ í´ë¦­í•´ì„œ ê±°ì£¼ì§€ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.</div>

        <input type="hidden" id="lat">
        <input type="hidden" id="lng">
    </div>

    <button onclick="doRegister()">ê°€ì…í•˜ê¸°</button>

    <div class="link">
        ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? <a href="/login">ë¡œê·¸ì¸</a>
    </div>
</div>

<script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=YOUR_KAKAO_JS_KEY&autoload=false"></script>

<script>
    kakao.maps.load(function() {
        var container = document.getElementById('map');
        var options = {
            center: new kakao.maps.LatLng(35.232, 129.082), // ê¸°ë³¸ê°’: ë¶€ì‚°ëŒ€ ë¶ë¬¸
            level: 4
        };
        var map = new kakao.maps.Map(container, options);

        // ë§ˆì»¤ ìƒì„± (ì´ˆê¸°ì—” ì§€ë„ ì¤‘ì‹¬ì—)
        var marker = new kakao.maps.Marker({
            position: map.getCenter()
        });
        marker.setMap(map);

        // ì´ˆê¸°ê°’ ì„¸íŒ…
        setLatLng(map.getCenter());

        // ì§€ë„ í´ë¦­ ì´ë²¤íŠ¸: ë§ˆì»¤ ì´ë™ ë° ì¢Œí‘œ ì €ì¥
        kakao.maps.event.addListener(map, 'click', function(mouseEvent) {
            var latlng = mouseEvent.latLng;

            // ë§ˆì»¤ ìœ„ì¹˜ ì´ë™
            marker.setPosition(latlng);

            // ì¢Œí‘œê°’ ì €ì¥
            setLatLng(latlng);
        });

        function setLatLng(latlng) {
            document.getElementById('lat').value = latlng.getLat();
            document.getElementById('lng').value = latlng.getLng();
        }
    });

    function doRegister() {
        const nickname = document.getElementById('nickname').value;
        const password = document.getElementById('password').value;
        const lat = document.getElementById('lat').value;
        const lng = document.getElementById('lng').value;

        if (!nickname || !password) {
            alert("ë‹‰ë„¤ì„ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
        }

        const data = {
            nickname: nickname,
            password: password,
            latitude: parseFloat(lat),
            longitude: parseFloat(lng)
        };

        fetch('/api/auth/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        })
            .then(async response => {
                if (response.ok) {
                    alert("íšŒì›ê°€ì… ì„±ê³µ! ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.");
                    window.location.href = "/login";
                } else {
                    let msg = await response.text();
                    alert("ê°€ì… ì‹¤íŒ¨: " + msg);
                }
            })
            .catch(err => {
                console.error(err);
                alert("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            });
    }
</script>

</body>
</html>